#!/usr/bin/env python
import sys
import subprocess


def show_logs(cmd):
    log_files=('/var/log/apache2/access.log',
           '/var/log/apache2/error.log')

    for lf in log_files:
        ssh_cmd('tail -n 50 {0}'.format(lf))

def apache_ctl(cmd):

    switcher = {
        'start': 'sudo service apache2 start',
        'stop' : 'sudo service apache2 stop',
        'restart': 'sudo service apache2 restart',
        'reload': 'sudo service apache2 reload',
    }

    shell_cmd = switcher.get(cmd, lambda: "nothing")

    ssh_cmd(shell_cmd)

def test(cmd):

    ssh_cmd('curl http://localhost:80')

def ssh_cmd(shell_cmd):

    print("{0}\n----------------------".format(shell_cmd))

    print subprocess.check_output(
        "ssh idp.dev.myunified.ca -l ubuntu {0}".format(shell_cmd),
        stderr=subprocess.STDOUT,
        shell=True)

def main():
    if len(sys.argv) < 2:
        sys.exit(1)

    switcher = {
        'start': apache_ctl,
        'stop' : apache_ctl,
        'restart': apache_ctl,
        'reload':apache_ctl,
        'logs' : show_logs,
        'test' : test,

    }

    func = switcher.get(sys.argv[1].strip(), lambda: "nothing")

    func(sys.argv[1].strip())

if __name__ == "__main__":
	main()
